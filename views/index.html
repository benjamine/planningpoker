<!DOCTYPE html> 
<html>
  <head>
    <title>planning poker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" media="screen">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.6/angular.min.js"></script>
    <script src="js/services.js"></script> 
    <script src="js/app.js"></script>
    <script src="js/poker.js"></script>
  </head>
  <body ng-app="planningShark">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">planning poker</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">start</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div ng-view class="container-fluid">
      <span>Loading...</span>
      <div class="progress progress-striped active" style="width:40%">
        <div class="bar" style="width: 70%;"></div>
      </div>
    </div>
    <!-- ng-templates -->
    <script type="text/ng-template" id="createjoin.html">
      <form ng-submit="join()">
        <label for="userName">User Name</label>
        <input type="text" name="userName" ng-model="userName" placeholder="who are you today?" required />
        <input type="hidden" name="channelId" ng-model="channelId" />
        <br>
        <button class='btn btn-primary'>Join</button>
      </form>
    </script>
    <script type="text/ng-template" id="channel.html">
       <div class="row-fluid">
        <div class="span12">
          <div class="row-fluid">
            <div class="span6">
              <p> 
                <b>participating as {{currentUser.name}}:</b>
              </p>
              <div class="btn-group">
                  <button ng-click="vote(card)" class="btn btn-small" 
                  ng-class="{'btn-primary' : currentUser.vote == card}" ng-repeat="card in deck">{{card}}</button>
              </div>
              <br>
            </div>
            <div class="span6" ng-show="isMaster">
            </div>
          </div>
          <div class="row-fluid">
            <div class="span6">
              <br>
              <table class="table table-striped table-condensed table-bordered" style="width:40%">
                <thead>
                  <th>
                    participant
                  </th>
                  <th>
                    vote
                  </th>
                </thead>
                <tbody>
                  <tr ng-repeat="user in users | orderBy: user.vote:reverse">
                    <td >{{user.name}}</td> 
                    <td>
                      <!-- Different states that the participant can be in. !-->
                      <span ng-show='revealed'>{{user.vote}}</span>
                      <span ng-show="(user.vote != null && !revealed)">voted</span>
                      <span ng-show="(user.vote == null)">joined</span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div ng-show='revealed'>
                <b>vote summary:</b>
                <table class="table table-striped table-condensed table-bordered" style="width:40%">
                  <thead>
                    <th>count</th>
                    <th>vote</th>
                  </thead>
                  <tbody>
                    <tr ng-repeat="voteCount in voteCounts | orderBy:'count':true" ng-show="voteCount.vote">
                      <td>
                        <span >{{voteCount.count}}</span>
                      </td>
                      <td>
                        <span>{{voteCount.vote}}<span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div>
                <button ng-show="(isMaster && !revealed)" class="btn btn-primary" ng-click='toggleVoteVisibility(true)'>reveal</button>
                <button ng-show="(isMaster && revealed)" class="btn btn-primary" ng-click='toggleVoteVisibility(false)'>hide</button>
                <button ng-show="isMaster" class="btn btn-inverse" ng-click='resetVotes()'>reset</button>
                <p>
                  send this link so that others can <a target="_blank" href="#/join/{{channelId}}" >join the planning</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>
    <!-- end ng-templates -->
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script src="//cdn.pubnub.com/pubnub-3.4.min.js"></script>
  </body>
</html>